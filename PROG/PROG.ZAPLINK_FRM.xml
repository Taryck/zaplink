<?xml version="1.0" encoding="utf-16"?>
<ZL_OBJECT CHECKSUM="0C2A7EB07223795E2835F40396895BA7" CONNECTOR="AAAD0A4B07A5A05AE1000000AC120173" NAME="ZAPLINK_FRM" TYPE="PROG" VERSION="1.0">
 <DIRECTORY SRCSYSTEM="OD4" AUTHOR="TBENSIAL" DEVCLASS="ZAPLINK-FRAMEWORK-CORE" MASTERLANG="E"/>
 <RAW>
  <A0_MAIN NAME="ZAPLINK_FRM" VARCL="X" SUBC="I" APPL="S" CNAM="TBENSIAL" CDAT="20090507" UNAM="TBENSIAL" UDAT="20091124" VERN="000060" RMAND="220" RLOAD="E" SDATE="20091124" STIME="174116" IDATE="20091124" ITIME="174116" UCCHECK="X"/>
  <SOURCE>*&amp;---------------------------------------------------------------------*
*&amp;  Include           ZAPLINK_FRM
*&amp;---------------------------------------------------------------------*
*/---------------------get_current_screen_value-----------------------\
FORM get_current_screen_value  USING    l_screen_field
                                        l_screen_number
                               CHANGING l_screen_value.

  DATA it_dynpfields TYPE STANDARD TABLE OF dynpread.
  DATA wa_dynpfields TYPE dynpread.


  wa_dynpfields-fieldname = l_screen_field.
  APPEND wa_dynpfields TO it_dynpfields.


  CALL FUNCTION &apos;DYNP_VALUES_READ&apos;
    EXPORTING
      dyname                         = sy-cprog
      dynumb                         = l_screen_number
      translate_to_upper             = &apos;X&apos;
*     REQUEST                        = &apos; &apos;
*     PERFORM_CONVERSION_EXITS       = &apos; &apos;
*     PERFORM_INPUT_CONVERSION       = &apos; &apos;
*     DETERMINE_LOOP_INDEX           = &apos; &apos;
    TABLES
      dynpfields                     = it_dynpfields
    EXCEPTIONS
      invalid_abapworkarea           = 1
      invalid_dynprofield            = 2
      invalid_dynproname             = 3
      invalid_dynpronummer           = 4
      invalid_request                = 5
      no_fielddescription            = 6
      invalid_parameter              = 7
      undefind_error                 = 8
      double_conversion              = 9
      stepl_not_found                = 10
      OTHERS                         = 11
            .
  IF sy-subrc &lt;&gt; 0.
*  MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*  WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
  ELSE.
    READ TABLE it_dynpfields INTO wa_dynpfields
      WITH KEY fieldname = l_screen_field.
    IF sy-subrc = 0.
      l_screen_value = wa_dynpfields-fieldvalue.
    ENDIF.
  ENDIF.


ENDFORM.                    &quot; get_current_screen_value
*/---------------------writeMessage-----------------------\
FORM writemessage USING value(p_type) TYPE sy-msgty
                        value(p_msg).
  CASE p_type.
    WHEN &apos;E&apos; OR &apos;A&apos; OR &apos;X&apos;.
      WRITE / icon_red_light AS ICON.
    WHEN &apos;W&apos;.
      WRITE / icon_yellow_light AS ICON.
    WHEN &apos;S&apos;.
      WRITE / icon_green_light AS ICON.
    WHEN OTHERS.
      WRITE / icon_light_out AS ICON. &quot; ICON_ARROW_RIGHT
  ENDCASE.

  WRITE p_msg.
ENDFORM.                    &quot;WriteMessage
*&amp;---------------------------------------------------------------------*
*&amp;      Form  DSP_RESULT_UNINSTALL
*&amp;---------------------------------------------------------------------*
FORM dsp_result_uninstall USING name TYPE t_nug_name.
  DATA msg    TYPE string.
  DATA t_comp TYPE t_comp.
  DATA _type  TYPE t_obj_type.
  DATA _name  TYPE t_obj_type.
  DATA _cx    TYPE t_exception.
  DATA _msg_col TYPE t_msg_col.

  WRITE: / &apos;Object list for nugget &apos;, name. SKIP.
  IF objlist IS BOUND.
    objlist-&gt;display_progress = abap_false.
    objlist-&gt;init_iter( ).
    t_comp = objlist-&gt;get_next( ).
  ENDIF.
  IF NOT t_comp IS BOUND.
    PERFORM writemessage USING &apos;W&apos; &apos;You have an empty Nugget&apos;.
    EXIT.
  ENDIF.

  WHILE t_comp IS BOUND.
    _type = t_comp-&gt;get_type( ).
    _name = t_comp-&gt;get_name( ).

    IF t_comp-&gt;connector_exists( ) = zaplink_gui=&gt;exists-not_exists.
      CONCATENATE _type &apos;-&apos; _name &apos;no plugin&apos;(npi)
          INTO msg SEPARATED BY space.
      PERFORM writemessage USING &apos;E&apos; msg.
    ELSEIF objlist-&gt;is_selected( t_comp ) = abap_false.
      CONCATENATE &apos;Uninstall&apos;(u01) &apos;:&apos; _type &apos;-&apos; _name &apos;not requested&apos;(nre)
          INTO msg SEPARATED BY space.
      PERFORM writemessage USING &apos;I&apos; msg.
    ELSEIF t_comp-&gt;exists( ) = zaplink_gui=&gt;exists-not_exists.
      CONCATENATE &apos;Uninstall&apos;(u01) &apos;:&apos; _type &apos;-&apos; _name &apos;SUCCEED&apos;(suc)
          INTO msg SEPARATED BY space.
      PERFORM writemessage USING &apos;S&apos; msg.
    ELSE.
      CONCATENATE &apos;Uninstall&apos;(u01) &apos;:&apos; _type &apos;-&apos; _name &apos;FAILED&apos;(fai)
          INTO msg SEPARATED BY space.
      PERFORM writemessage USING &apos;E&apos; msg.
      _cx ?= t_comp-&gt;get_exception( ).
      IF _cx IS BOUND.
        _cx-&gt;write( ).
      ELSE.
        _msg_col ?= t_comp-&gt;get_msg_coll( ).
        IF _msg_col IS BOUND.
          _msg_col-&gt;write( ).
        ENDIF.
      ENDIF.
    ENDIF.

    t_comp = objlist-&gt;get_next( ).
  ENDWHILE.

ENDFORM.                    &quot; DSP_RESULT_UNINSTALL
*&amp;---------------------------------------------------------------------*
*&amp;      Form  DSP_RESULT_DISPLAY
*&amp;---------------------------------------------------------------------*
FORM dsp_result_display USING name TYPE t_nug_name
                           objlist TYPE t_objlist
                            offset TYPE string.
  DATA msg    TYPE string.
  DATA t_comp TYPE t_comp.
  DATA _type  TYPE t_obj_type.
  DATA _name  TYPE t_obj_name.
  DATA _cx    TYPE t_exception.
  DATA _msg_col TYPE t_msg_col.
  DATA _subc  TYPE t_objlist.
  DATA _offset TYPE string.
  CONSTANTS s_inc TYPE string VALUE `  `.

  IF NOT name IS INITIAL.
    WRITE: / &apos;Object list for nugget &apos;, name. SKIP.
  ENDIF.
  IF objlist IS BOUND.
    objlist-&gt;display_progress = abap_false.
    objlist-&gt;init_iter( ).
    t_comp = objlist-&gt;get_next( ).
  ENDIF.
  IF NOT name IS INITIAL AND NOT t_comp IS BOUND.
    PERFORM writemessage USING &apos;W&apos; &apos;You have an empty Nugget&apos;.
    EXIT.
  ENDIF.

  CONCATENATE offset s_inc INTO _offset.

  WHILE t_comp IS BOUND.
    _type = t_comp-&gt;get_type( ).
    _name = t_comp-&gt;get_name( ).

    IF t_comp-&gt;connector_exists( ) = zaplink_gui=&gt;exists-not_exists.
      CONCATENATE offset _type &apos;-&apos; _name &apos;no plugin&apos;(npi)
          INTO msg SEPARATED BY space.
      PERFORM writemessage USING &apos;E&apos; msg.
    ELSEIF objlist-&gt;is_selected( t_comp ) = abap_false.
      CONCATENATE offset _type &apos;-&apos; _name &apos;not requested&apos;(nre)
          INTO msg SEPARATED BY space.
      PERFORM writemessage USING &apos;I&apos; msg.
    ELSE.

      _cx ?= t_comp-&gt;get_exception( ).
      _msg_col ?= t_comp-&gt;get_msg_coll( ).
      IF _msg_col IS BOUND.
        IF _msg_col-&gt;has_messages_of_msgt( &apos;E&apos; ) = abap_false .
          CLEAR _msg_col.
        ENDIF.
      ENDIF.
      IF _cx IS BOUND OR _msg_col IS BOUND.
        CONCATENATE offset _type &apos;-&apos; _name &apos;FAILED&apos;(fai)
            INTO msg SEPARATED BY space.
        PERFORM writemessage USING &apos;E&apos; msg.
        IF _cx IS BOUND.
          _cx-&gt;write( ).
        ELSE.
          IF _msg_col IS BOUND.
            _msg_col-&gt;write( ).
          ENDIF.
        ENDIF.
      ELSE.
        CONCATENATE offset _type &apos;-&apos; _name &apos;SUCCEED&apos;(suc)
            INTO msg SEPARATED BY space.
        PERFORM writemessage USING &apos;S&apos; msg.
      ENDIF.

      _msg_col ?= t_comp-&gt;get_msg_coll( ).
      IF _msg_col IS BOUND.
        _msg_col-&gt;write( ).
      ENDIF.

    ENDIF.

    _subc = t_comp-&gt;get_subcomponents( ).
    IF _subc IS BOUND.
      PERFORM dsp_result_display USING space _subc _offset.
    ENDIF.

    t_comp = objlist-&gt;get_next( ).
  ENDWHILE.

ENDFORM.                    &quot; DSP_RESULT_DISPLAY
*&amp;---------------------------------------------------------------------*
*&amp;      Form  NUGGET_CREATE
*&amp;---------------------------------------------------------------------*
FORM nugget_create .
  nug_name = nuggnam.
  TRY.
      CALL METHOD zaplink_gui=&gt;create
        EXPORTING
          name = nug_name.
    CATCH zaplink_cx INTO o_exception.
      stemp = o_exception-&gt;get_text( ).
      PERFORM writemessage USING &apos;E&apos; stemp.
      EXIT.
  ENDTRY.
  PERFORM writemessage USING &apos;S&apos; &apos;Nugget created&apos;(ncs).
ENDFORM.                    &quot; NUGGET_CREATE
*&amp;---------------------------------------------------------------------*
*&amp;      Form  NUGGET_ADD
*&amp;---------------------------------------------------------------------*
FORM nugget_add .
  nug_filename = nugfile.
  obj_type = nplugin.
  obj_name = nobjnam.
  TRY.
      CALL METHOD zaplink_gui=&gt;add_object
        EXPORTING
          objtype = obj_type
          name    = obj_name
          nugget  = nug_filename.
    CATCH zaplink_cx INTO o_exception.
      stemp = o_exception-&gt;get_text( ).
      PERFORM writemessage USING &apos;E&apos; stemp.
      EXIT.
  ENDTRY.
ENDFORM.                    &quot; NUGGET_ADD
*&amp;---------------------------------------------------------------------*
*&amp;      Form  NUGGET_IMPORT
*&amp;---------------------------------------------------------------------*
FORM nugget_import .
  nug_filename = nugfile.
  TRY.
      CALL METHOD zaplink_gui=&gt;import
        EXPORTING
          nugget     = nug_filename
        IMPORTING
          nuggetname = nug_name
*        CHANGING
          list       = objlist.
    CATCH zaplink_cx INTO o_exception.
      stemp = o_exception-&gt;get_text( ).
      PERFORM writemessage USING &apos;E&apos; stemp.
      EXIT.
  ENDTRY.

  PERFORM dsp_result_display USING nug_name objlist space.
ENDFORM.                    &quot; NUGGET_IMPORT
*&amp;---------------------------------------------------------------------*
*&amp;      Form  NUGGET_DISPLAY
*&amp;---------------------------------------------------------------------*
FORM nugget_display .
  nug_filename = nugfile.
  TRY.
      objlist = zaplink_gui=&gt;get_objlist( nugget = nug_filename ).
*    CATCH zaplink_cx INTO old_exception.
*      stemp = o_exception-&gt;get_text( ).
*      PERFORM writemessage USING &apos;E&apos; stemp.
*      EXIT.
    CATCH zaplink_cx INTO o_exception.
      o_exception-&gt;write( ).
      EXIT.
  ENDTRY.
  PERFORM dsp_result_display USING space objlist space.
ENDFORM.                    &quot; NUGGET_DISPLAY
*&amp;---------------------------------------------------------------------*
*&amp;      Form  NUGGET_UNINSTALL
*&amp;---------------------------------------------------------------------*
FORM nugget_uninstall .
  nug_filename = nugfile.
  TRY.
      CALL METHOD zaplink_gui=&gt;uninstall
        EXPORTING
          nugget = nug_filename
        IMPORTING
          name   = nug_name
        CHANGING
          list   = objlist.
    CATCH zaplink_cx INTO o_exception.
  ENDTRY.
  PERFORM dsp_result_uninstall USING nug_name.
ENDFORM.                    &quot; NUGGET_UNINSTALL
*&amp;---------------------------------------------------------------------*
*&amp;      Form  NUGGET_PACKAGE
*&amp;---------------------------------------------------------------------*
FORM nugget_package .
  DATA:
    r_package TYPE zaplink_gui=&gt;tr_packages,
    _wa LIKE LINE OF r_package.
  DATA _keys TYPE zaplink_gui=&gt;tt_compkeys.

  IF package  IS INITIAL.
    MESSAGE s208(00) WITH &apos;package required&apos;.
    EXIT.
  ENDIF.

  _wa-sign = &apos;I&apos;. _wa-option = &apos;EQ&apos;.
  _wa-low = package. APPEND _wa TO r_package.

  _keys = zaplink_gui=&gt;get_keys_from_package( r_package ).
  CREATE OBJECT objlist.
  objlist-&gt;add_keys( _keys ).
  objlist-&gt;select_default( zaplink_list=&gt;sel_actions-export ).
  objlist-&gt;change_selection( ).

  nug_filename = nugfile.
  TRY.
      CALL METHOD zaplink_gui=&gt;export
        EXPORTING
          nugget  = nug_filename
        CHANGING
          objlist = objlist.
    CATCH zaplink_cx INTO o_exception.
      stemp = o_exception-&gt;get_text( ).
      PERFORM writemessage USING &apos;E&apos; stemp.
      EXIT.
  ENDTRY.

  PERFORM dsp_result_display USING space objlist space.

ENDFORM.                    &quot; NUGGET_PACKAGE
*&amp;---------------------------------------------------------------------*
*&amp;      Form  NUGGET_TR
*&amp;---------------------------------------------------------------------*
FORM nugget_tr .
  DATA:
    r_tr TYPE zaplink_gui=&gt;tr_tr.
  DATA _keys TYPE zaplink_gui=&gt;tt_compkeys.

  IF reqnugg[] IS INITIAL.
    MESSAGE s208(00) WITH &apos;Transport Request required&apos;.
    EXIT.
  ENDIF.

  r_tr = reqnugg[].

  _keys = zaplink_gui=&gt;get_keys_from_tr( r_tr ).
  CREATE OBJECT objlist.
  objlist-&gt;add_keys( _keys ).
  objlist-&gt;select_default( zaplink_list=&gt;sel_actions-export ).
  objlist-&gt;change_selection( ).

  nug_filename = nugfile.
  TRY.
      CALL METHOD zaplink_gui=&gt;export
        EXPORTING
          nugget  = nug_filename
        CHANGING
          objlist = objlist.
    CATCH zaplink_cx INTO o_exception.
      stemp = o_exception-&gt;get_text( ).
      PERFORM writemessage USING &apos;E&apos; stemp.
      EXIT.
  ENDTRY.

  PERFORM dsp_result_display USING space objlist space.

ENDFORM.                    &quot; NUGGET_TR</SOURCE>
  <TEXTSPOOL>
   <ITEM ID="R">
    <TEXTS>
     <ITEM LANGU="E" ENTRY="Include ZAPLINK_FRM" LENGTH="19 "/>
    </TEXTS>
   </ITEM>
  </TEXTSPOOL>
 </RAW>
</ZL_OBJECT>
